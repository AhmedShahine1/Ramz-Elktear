name: Deploy to IIS

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: windows-latest

    steps:
    - name: ğŸ·ï¸ Checkout code
      uses: actions/checkout@v4

    - name: ğŸ› ï¸ Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '9.0.x'

    - name: ğŸ“¦ Build & Publish
      run: |
        dotnet restore
        dotnet publish -c Release -o ./publish

    - name: ğŸš€ Deploy to IIS
      uses: djad442/simply-web-deploy-powershell@v1.0.2
      with:
        website-name: "YourSiteName"  # Exact IIS site name
        server-computer-name: ${{ secrets.DEPLOY_SERVER_NAME }}
        server-username: ${{ secrets.DEPLOY_USERNAME }}
        server-password: ${{ secrets.DEPLOY_PASSWORD }}
        source-path: "./publish"
        target-path: "C:\inetpub\wwwroot\YourSiteName"
        auth-type: "NTLM"
        port: "8172"
