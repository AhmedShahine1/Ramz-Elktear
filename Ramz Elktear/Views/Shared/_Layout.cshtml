@using Microsoft.AspNetCore.Builder
@using Microsoft.AspNetCore.Localization
@using Microsoft.Extensions.Options
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@inject IOptions<RequestLocalizationOptions> LocOptions
@inject Microsoft.AspNetCore.Identity.UserManager<ApplicationUser> UserManager
@inject Microsoft.AspNetCore.Identity.SignInManager<ApplicationUser> SignInManager

@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var cultureItems = LocOptions.Value.SupportedUICultures
        .Select(c => new SelectListItem { Value = c.Name, Text = c.DisplayName })
        .ToList();
    var currentCulture = requestCulture?.RequestCulture.Culture.Name ?? "en";
    var isRtl = currentCulture == "ar";
    var returnUrl = Context.Request.Path + Context.Request.QueryString;

    var userProfileImage = Context.Request.Cookies["userProfileImage"];
    var userName = Context.Request.Cookies["userName"];
    var userRole = Context.Request.Cookies["userRole"];
}

<!doctype html>
<html lang="@currentCulture"
      class="light-style layout-menu-fixed layout-compact"
      dir="@(isRtl ? "rtl" : "ltr")">
<head>
    <meta charset="utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Ramz Elktear</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon/group 92.ico" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
          rel="stylesheet" />

    <link href="~/assets/vendor/fonts/boxicons.css" rel="stylesheet" />

    <!-- Core CSS -->
    <link href="~/assets/vendor/css/core.css" rel="stylesheet" />

    <!-- Load appropriate direction stylesheet -->
        <link href="~/assets/vendor/css/core.css" rel="stylesheet" id="rtl-core-stylesheet" />
        <link href="~/assets/vendor/css/theme-default.css" rel="stylesheet" id="ltr-stylesheet" />
        <link href="~/assets/vendor/css/theme-default.css" rel="stylesheet" id="rtl-stylesheet" />

    <link href="~/assets/css/demo.css" rel="stylesheet" />

    <!-- Vendors CSS -->
    <link href="~/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" />
    <link href="~/assets/vendor/libs/apex-charts/apex-charts.css" rel="stylesheet" />

    <!-- Page CSS -->
    <!-- Helpers -->
    <script src="~/assets/vendor/js/helpers.js"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="~/assets/js/config.js"></script>

    <!-- Store the current culture in a JavaScript variable -->
    <script>
        var currentCulture = '@currentCulture';
        var isRtl = '@isRtl.ToString().ToLower()' === 'true';
    </script>
</head>

<body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
        <div class="layout-container">
            <!-- Menu -->
            <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
                <div class="app-brand demo">
                    <a href="@Url.Action("Index", "Home")" class="app-brand-link">
                        <span class="app-brand-logo demo">
                            <img src="@Context.Request.Cookies["siteLogo"]" style="width: 200px;" />
                        </span>
                    </a>

                    <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none">
                        <i class="bx bx-chevron-left bx-sm d-flex align-items-center justify-content-center"></i>
                    </a>
                </div>
                <!-- Include the menu partial view -->
                @await Html.PartialAsync("_MainMenu")
            </aside>
            <!-- / Menu -->
            <!-- Layout container -->
            <div class="layout-page">
                <!-- Navbar -->
                <nav class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
                     id="layout-navbar">
                    <div class="layout-menu-toggle navbar-nav align-items-xl-center me-4 me-xl-0 d-xl-none">
                        <a class="nav-item nav-link px-0 me-xl-6" href="javascript:void(0)">
                            <i class="bx bx-menu bx-md"></i>
                        </a>
                    </div>

                    <div class="navbar-nav d-flex align-items-center w-100" id="navbar-collapse">
                        <!-- Left Section (User Profile) -->
                        <ul class="navbar-nav flex-row align-items-center" id="left-section" style="padding-right: 0px;">
                            <li class="nav-item dropdown">
                                <div class="d-flex">
                                    <div class="flex-shrink-0 me-3">
                                        <div class="avatar">
                                            <img src="@userProfileImage" alt="Profile Image" class="w-px-30 h-auto rounded-circle" />
                                        </div>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h6 class="mb-0">@userName</h6>
                                        <small class="text-muted">@userRole</small>
                                    </div>
                                </div>
                            </li>
                        </ul>

                        <!-- Right Section (Language, Fullscreen, Logout) -->
                        <ul class="navbar-nav flex-row align-items-center @(isRtl ? "" : "ms-auto")" id="right-section">
                            <!-- Language switcher with globe icon -->
                            <li class="nav-item dropdown me-3">
                                <a class="nav-link dropdown-toggle" href="javascript:void(0);" id="navbarLanguageSwitcher" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="bx bx-globe bx-md"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarLanguageSwitcher">
                                    <li>
                                        <form id="form-en" asp-controller="Localization" asp-action="SetLanguage" method="post">
                                            <input type="hidden" name="culture" value="en" />
                                            <input type="hidden" name="returnUrl" value="@returnUrl" />
                                            <button type="submit" class="dropdown-item @(currentCulture == "en" ? "active" : "")">
                                                <i class="flag-icon flag-icon-us me-2"></i> English
                                            </button>
                                        </form>
                                    </li>
                                    <li>
                                        <form id="form-ar" asp-controller="Localization" asp-action="SetLanguage" method="post">
                                            <input type="hidden" name="culture" value="ar" />
                                            <input type="hidden" name="returnUrl" value="@returnUrl" />
                                            <button type="submit" class="dropdown-item @(currentCulture == "ar" ? "active" : "")">
                                                <i class="flag-icon flag-icon-sa me-2"></i> العربية
                                            </button>
                                        </form>
                                    </li>
                                </ul>
                            </li>

                            <!-- Full Screen Button -->
                            <li class="nav-item me-3">
                                <a class="nav-link" href="javascript:void(0);" onclick="toggleFullScreen()">
                                    <i class="bx bx-fullscreen bx-md"></i>
                                </a>
                            </li>

                            <!-- Log Out Button -->
                            <li class="nav-item">
                                <a class="nav-link text-danger" href="@Url.Action("Logout", "Auth")">
                                    <i class='bx bx-log-out bx-md'></i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>
                <div class="content-wrapper">
                    <div class="container-xxl flex-grow-1 container-p-y">
                        <div class="card" style="padding:10px">
                            <div class="table-responsive text-wrap">
                                @RenderBody()
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- / Layout page -->
        </div>

        <!-- Overlay -->
        <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->
    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->

    <script src="~/assets/vendor/libs/jquery/jquery.js"></script>
    <script src="~/assets/vendor/libs/popper/popper.js"></script>
    <script src="~/assets/vendor/js/bootstrap.js"></script>
    <script src="~/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="~/assets/vendor/js/menu.js"></script>

    <!-- endbuild -->
    <!-- Vendors JS -->
    <script src="~/assets/vendor/libs/apex-charts/apexcharts.js"></script>

    <!-- Main JS -->
    <script src="~/assets/js/main.js"></script>

    <!-- Page JS -->
    <script src="~/assets/js/dashboards-analytics.js"></script>

    <!-- Add our culture handler script -->
    <script src="~/assets/js/culture-handler.js"></script>

    @RenderSection("Scripts", required: false)
</body>
</html>